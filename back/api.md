# Part1 开发给前端展示的接口

### 1. 

#### 接口
- `get /taxi`：获取示例数据
- `post /taxi`：输入请求条件查询数据

#### 参数格式

| 参数项     | 格式                               | 示例                                                         |
| ---------- | ---------------------------------- | ------------------------------------------------------------ |
| `geo`      | `[maxlng, minlng, maxlat, minlat]` | `[120.723029, 120.627524, 28.027669, 27.988246]`             |
| `time`     | `[min, max]`                       | `["00:06:33", "00:12:56"]`                                   |
| `boolOp`   | 1 或 2                             | 1 表示 Union并集，2 表示 Intersection交集，不传默认为 2      |
| `boolFull` | `true` 或 `false`  不传为 `false`  | 表示查询返回的轨迹是否为整条轨迹（若为 `false` 则表示返回在时空范围内的轨迹片段） |

~~***当前 geo、time 必须都传***。若不传，后端会自动添加一个比较小的范围~~

#### 数据格式
```json
[
    {
        "id": "浙C05132.LOG-0",
        "points": [
            {
                "longitude": 120.642326355,
                "latitude": 28.0106506348,
                "time": "2014-01-01 00:00:11"
            },
            {
                "longitude": 120.6402282715,
                "latitude": 28.0094795227,
                "time": "2014-01-01 00:00:41"
            }
        ]
    }
]
```

### 2. 手机基站轨迹

#### 接口

- `get /phone`：获取示例数据
- `post /phone`：输入请求条件查询数据

#### 参数格式

同出租车数据参数

#### 数据格式
```json
[
  {
    "id": "460001800413250-0",
    "points": [
        {
            "time": "2014-01-14 06:00:21.91",
            "longitude": 120.62566,
            "latitude": 27.99015
        },
        {
            "time": "2014-01-14 06:00:38.01",
            "longitude": 120.59704,
            "latitude": 27.97367
        }
    ]
  }
]
```

### 3. 微博数据
#### 接口
- `get /weibo`：获取所有数据
- `post /weibo`：输入请求条件查询数据

#### 参数格式

| 参数项   | 格式                               | 示例                                                    |
| -------- | ---------------------------------- | ------------------------------------------------------- |
| `geo`    | `[maxlng, minlng, maxlat, minlat]` | `[120.723029, 120.627524, 28.027669, 27.988246]`        |
| `time`   | `[min, max]`                       | `["00:06:33", "00:12:56"]`                              |
| `keyword`    | `string`  `name`或`content`中包含关键字 | `丢失`  |


#### 数据格式
```json
  [
      {
          "id": "ee68d0ee-7da1-11eb-9c38",
          "time": "2014-01-14 00:50",
          "name": "红唇",
          "content": "1月14日凌晨00：49从松台广场到杏花路百花苑丢...",
          "road": "杏花路百花苑",
          "lng": 120.6462979,
          "lat": 28.00516276
      }
  ]
```

### 4. POI 数据
#### 接口
- `get /poi`：获取所有POI数据
- `post /poi`：输入请求条件查询数据
#### 参数格式

| 参数项   | 格式                               | 示例                                                    |
| -------- | ---------------------------------- | ------------------------------------------------------- |
| `geo`    | `[maxlng, minlng, maxlat, minlat]` | `[120.723029, 120.627524, 28.027669, 27.988246]`        |
| `keyword`    | `string`   名称中包含关键字 | `医院`    |

***若 geo 不传，返回全量数据***

#### 数据格式
```json
  {
      "id": "001a7d352bbe17d45bf6be3b",
      "name": "东方医院江滨社区卫生服务中心",
      "type": "医疗",
      "longitude": 120.66608428955078,
      "latitude": 28.015108108520508
  }
```



###  5. 输入一个数据源和一个条数据的 ID，返回以该条数据对应的 cubes 或单维度条件查询所得的数据

#### 请求

`post /queryByDataId`

#### 参数格式

| 参数项   | 格式                               | 示例                                                    |
| -------- | ---------------------------------- | --------------------------------------------------- |
| `id`   数据 data 唯一 id | `string`|    |
| `originSource`  原始数据源类型（即上述data对应的数据源）  | ``mobileTraj=0、taxiTraj=1、weibo=2、poi=3`` |  0  |
| `targetSource`  目标数据源类型  | ``mobileTraj=0、taxiTraj=1、weibo=2、poi=3`` |  0  |
| `mode` 查询模式 | `0`  用时空属性（stccues）查询，`1` 用时间属性查询，`2` 用空间属性查询 | 不传默认`0` |

#### 数据格式

返回的数据格式与上面几个查询数据源返回的格式相同，该接口仅查询条件不同



---

#  Part2 开放给 Python 后端训练的接口

### 1. 查询数据

#### 请求
`post py/query`

#### 参数格式
| 参数项   | 格式                               | 示例                                                    |
| -------- | ---------------------------------- | --------------------------------------------------- |
| `source`  数据源类型  | `mobileTraj=0、taxiTraj=1、weibo=2、poi=3` |  1  |
| `attr`  查询条件 | `{ geo, time, keyword }` |  |
| `geo`   地理空间 | `[maxlng, minlng, maxlat, minlat]` | `[120.723029, 120.627524, 28.027669, 27.988246]` |
| `time`   时间范围 | ` [min, max]` | `["00:06:33", "00:12:56"]` |
| `keyword`   属性 `暂未实现` | `string`   当前至支持关键字的查询 | `医院` |

#### 数据格式

```json
[
    {
        "id": "浙C04937.LOG",
        "bbx": {
          "time": ["00:00:03", "23:59:45"],
          "geo": [120.723029, 120.627524, 28.027669, 27.988246]
        },
      	"stcubes": [  // 时空单元
						"0",
            "50",
            "100",
            "150",
            "200",
            "461",
        ],
      	"scube": [  // 地理单元（与时空单元对应）
						"0",
            "0",
            "0",
            "0",
            "0",
	          "11",
        ]
    },
]
```

### 2. 输入一个数据源和一个条数据的 ID，返回以该条数据对应的 cubes 或 单维度条件查询所得的数据

#### 请求

`post py/queryByDataId`

#### 参数格式

| 参数项   | 格式                               | 示例                                                    |
| -------- | ---------------------------------- | --------------------------------------------------- |
| `id`   数据 data 唯一 id | `string`|    |
| `originSource`  原始数据源类型（即上述data对应的数据源）  | ``mobileTraj=0、taxiTraj=1、weibo=2、poi=3`` |  0  |
| `targetSource`  目标数据源类型  | ``mobileTraj=0、taxiTraj=1、weibo=2、poi=3`` |  0  |
| `mode` 查询模式 | `0`  用时空属性（stccues）查询，`1` 用时间属性查询，`2` 用空间属性查询 | 不传默认`0` |

#### 数据格式

返回结果格式同上，即 `post py/query`  返回的结果 

若按照对应条件查询不到，返回 `[]`

#### 注意点
- 由于 POI 数据中无时间属性，因此使用 POI 数据对应的条件来查询其他时空数据源时，当前传的时间条件为 `["00:00:00","00:10:00"]`



### 3. Mock一个随机数据查询条件，使用该条件查询获得的数据具有一定数量

#### 请求

`get py/mockReq`

#### 参数格式

```json
{
	source : 1,
  attr: {
     "time": ["00:00:03", "23:59:45"],
     "geo": [120.723029, 120.627524, 28.027669, 27.988246]
  }
}

```

---

# Part3

### 1.  获取四个数据源的数据 id 集合

#### 请求

`post py/queryDataSetIds`

#### 数据格式

```javascript
[
    "460026581700769",  // phone
    "460026581701842",
		 ...
    "460026637516231",
    "浙C02668.LOG",    // taxi
    "浙C02678.LOG",
  	...
    "浙C04248.LOG",
    "ef05a5e0-7da1-11eb-9c38",   // weibo
    "ef05bd00-7da1-11eb-9c38",
		...
    "ef05c67e-7da1-11eb-9c38",
		"afc508c05c111d09213bf294",  // poi
    "73ce97117cf8a719c42ba1be", 
 		...   
    "ef773a0f154cc149220220fb"
]
```

### 2.  获取时空立方体的配置信息

#### 请求

`get py/querySTConfig`

#### 数据格式

```javascript
{
    "scubeNum": 50  // 地理空间上单元数 10 * 5 
}
```



### 3.  区域概率热力图

#### 请求

`get scubeHeatMap`

#### 数据格式

所有单元的 `value` 总和为 1

```javascript
[
    {
        "value": 0.007879372061869758,
        "longitude": 120.60075375,
        "latitude": 27.950521249999998
    },
    {
        "value": 0.019623585107630296,
        "longitude": 120.61620325,
        "latitude": 27.950521249999998
    },
  	...
]
```

